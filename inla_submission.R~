library(pROC)
library(INLA)
library(plyr)

X_train <- read.csv("train_filled_new.csv")
X_test <- read.csv("test_filled_new.csv")

    y_train <- read.csv(paste(basedir, year, "y_train.csv", sep=''))
    y_test <- read.csv(paste(basedir, year, "y_test.csv", sep=''))
    y_test <- y_test$WnvPresent

    df_train <- cbind(X_train, y_train)
    df_test <- cbind(X_test, y_test)

    df_test <- rename(df_test, c("y_test"="WnvPresent"))
    
    test$Species <- gsub("UNSPECIFIED CULEX", "CULEX PIPIENS", test$Species)

    train_for_loo <- train
    train_for_loo$NumMosquitos <- NULL
    train_for_loo$AddressAccuracy <- NULL
    train_for_loo$AddressNumberAndStreet <- NULL
    train_for_loo$Address <- NULL
    train_for_loo$Street <- NULL
    train_for_loo$CodeSum <- NULL
    
    df <- rbind(df_train, df_test)

    model <- inla(WnvPresent ~ Species
                 + Block
                 + Trap
                 + Latitude
                 + Longitude
                 + X9_week_avrgPrecipTotal
                 + X9_week_avrgTavg

                 + X7_week_avrgPrecipTotal
                 + X7_week_avrgTavg
                  
                 + Latitude * Longitude


                  + Month * Species
                  
                , data=df,
                  control.predictor = list(link = 1))
    #ypred <- predict(model, X_test)
    ypred <- model$summary.fitted.values$mean[(length(X_train$Trap) + 1) : (length(X_train$Trap) + length(X_test$Trap))]

    g <- roc(y_test, ypred)
    print(g)

    
}
